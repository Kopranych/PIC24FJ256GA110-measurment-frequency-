/* 
 * File:   InterruptVector.h
 * Author: Kopranov_IN
 *
 * Created on 19 ???? 2016 ?., 13:53
 */

#include <stdio.h>
#include <stdlib.h>
#include <p24fj256ga110.h>
#include "Timer.h"

#define NUMMEAS 6//number measurments
#define VALUE_CAUNTER_L TMR2
#define VALUE_CAUNTER_H TMR3


enum current_account{ //
    mode1,
    mode2,
    mode3,
    mode4,
    mode5,
    mode6
}mode;
//enum current_mode mode = 0;//


unsigned long int current_value;
int FLAG1 = 0, FLAG2 = 0, flag_interrupt = 0;

unsigned long int medium_value = 0;

void _ISRFAST _T1Interrupt(void)
{
    _T1IF=0;
    current_value = (TMR3<<8)|(TMR2);
    TMR3 = 0;
    TMR2 = 0;
    flag_interrupt = 1;
}

//void __attribute__((__interrupt__)) _T1Interrupt(void);//???????? ????? ????????? ?????????? ?????????? ?? ?????? ??? ???????
/*void _ISRFAST _IC1Interrupt(void)//? C30 ???? ??????? ?????????? ?????????. ????? ??? ???????????? ?????????? ????????? ???
{
    _IC1IF = 0;//?????????? ???? ??????????
    if(mode == mode4)
    {
        medium_value += current_value;
        medium_value = medium_value/4;
//        SPI = medium_value;
        mode = mode1;
    }
    else
    {
        medium_value += current_value;
//        SPI = current_value - ideal_value;
        mode++;
    }
}
    




void init(void)//initialization
{
//...
IC1CON1bits.ICM = 0x05;  // enable input capture to mode 16 front
_IC1IF=0;       // ?????????? ???? ?????????? ?? ?????? ??????
_IC1IP=4;       // ????????????? ?????????
_IC1IE=1;       // ????????? ??????????
//...
}
*/

